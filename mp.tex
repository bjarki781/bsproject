\documentclass[a4paper, 11pt, english]{article}
\usepackage[top=3.17cm, bottom=3.27cm, left=3.5cm, right=3.5cm]{geometry}
%\setlength{\parindent}{2.5em}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
{\renewcommand{\arraystretch}{1.3}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{latexsym}
\usepackage{amsmath,amsthm,amssymb,amsfonts}
\usepackage{eucal}
\usepackage[english]{babel}
\usepackage{tikz}
\usepackage{epsfig}
\usepackage{amssymb, graphicx, amsmath, amsthm}
\usepackage{calrsfs}
\usepackage{todonotes}
\usepackage[hidelinks]{hyperref}
\usepackage{bm}
\usepackage{appendix}
\usepackage{multicol}
\usepackage[useregional]{datetime2}
\usepackage{listings}
\usepackage{tikz-cd}

\RequirePackage{graphicx}
\RequirePackage{hyperref}
\newcommand{\parm}{\mathord{\color{black!33}\bullet}}

\newcommand{\breath}{\vspace{6pt plus 2pt minus 1pt}\noindent}

\newcommand{\pattern}[4]{
  \raisebox{0.6ex}{
  \begin{tikzpicture}[scale=0.3, baseline=(current bounding box.center), #1]
    \foreach \x/\y in {#4}
      \fill[NE-lines] (\x,\y) rectangle +(1,1);
    \draw (0.01,0.01) grid (#2+0.99,#2+0.99);
    \foreach \x/\y in {#3}
      \filldraw (\x,\y) circle (5pt);
  \end{tikzpicture}}
}

\newcommand{\patternrule}{ \mapsto \!}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{openproblem}[theorem]{Open Problem}
\newtheorem*{openproblem*}{Open Problem}
\newtheorem{conjecture}[theorem]{Conjecture}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{remark}[theorem]{Remark}
\newtheorem*{remark*}{Remark}
\newtheorem{example}[theorem]{Example}
\newtheorem*{example*}{Example}

\newcommand{\eps}{\epsilon}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\etal}{et~al.}
\newcommand{\Sym}{S}
\newcommand{\Pow}{\mathcal{P}}
\newcommand{\Ocal}{\mathcal{O}}
\newcommand{\emptyword}{\varepsilon}
\newcommand{\id}{\mathrm{id}}
\newcommand{\rid}{\overline{\id}}
\newcommand{\from}{\leftarrow}
\newcommand{\eq}{\leftrightarrow}
\newcommand{\eqstar}{\stackrel{*}{\leftrightarrow}}
\newcommand{\tostar}{\stackrel{*}{\to}}
\newcommand{\toplus}{\stackrel{+}{\to}}
\newcommand{\fromstar}{\stackrel{*}{\from}}
\newcommand{\nf}[1]{{#1\!\downarrow}}
\newcommand{\floor}[1]{\lfloor#1\rfloor}
\newcommand{\bracket}[1]{[\mskip1mu #1\mskip1mu]}
\DeclareMathOperator{\olap}{\mathcal{O}}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\img}{img}
\DeclareMathOperator{\des}{des}
\DeclareMathOperator{\maj}{maj}
\DeclareMathOperator{\shr}{shr}

\begin{document}

\title{Enumerating Hertzsprung equivalence classes defined by partitions of the symmetric group of degree 3}
\author{Bjarki Hartjenstein Gunnarsson}
\date{\today}
\maketitle

\begin{abstract}
    Hertzsprung patterns are permutation patterns in which both positions and
    values are required to be adjacent. Families of equivalences of these
    patterns induce equivalence classes. In this paper we introduce a method
    that allows us, given an equivalence relation, to enumerate these
    equivalence classes. This in turn allows us to determine the Wilf-classes of
    all the set partitions of $\Sym_3$.
    \breath \emph{Keywords}: permutation pattern, pattern-rewriting system
\end{abstract}

\section{Introduction}
Permutation patterns are permutations which we can match with parts of other
permutations, under various constrains, which are formalized by mesh patterns.
\cite{claesson:2011}

Classical permutation patterns do not have any constraints on their matches but then we can
constrain them such that the matches' positions or values must be adjacent.
Hertzsprung patterns constrain both. 

In this demonstration we make pattern matches bold.  Let us treat $132$ as classical
pattern, then we would have the following matches in the permutation $15432$.
\[
    \bm{154}32
\]
\[
    \bm{1}54\bm{32}
\]
We will look again at the same pattern and permutation, but assume that the
pattern match is constrained by positions. Then we have the match
\[
    \bm{154}32.
\]
Again, looking at at the same pattern and permutation, but assume that the
pattern is constrained so that the values must be adjacent we have the following
match:
\[
    \bm{1}54\bm{32}.
\]

Hertzsprung patterns constrain the match so both values and positions must be
adjacent. There is no match for the Hertzsprung pattern $132$ in the example
above but as a showcase, given the pattern $132$ and the permutation $1243$ we
have the Hertzsprung match
\[
    1\bm{243}.
\]

From this point onward, everytime we mention patterns we are speaking about
Hertzsprung patterns.

Finally, a Hertzsprung pattern that matches at the beginning of a permutation is
called the (Hertzsprung) \emph{prefix} of that permutations, same with a pattern
match at the end of a permutation, it is called a [Hertzsprung] \emph{suffix}.

\subsection{Equivalence, equivalence classes and motivation}
We can look at patterns as being equivalent. We say transposition of each pattern into
the other in a permutation will result in an equivalent permutation. Throughout
this article we represent some equivalent patterns with be a family of sets, signifying
a family of equivalences:
\[
    \{ \{\alpha, \beta, \gamma, \dots \}, \{\lambda, \mu, \nu, \dots \}, \dots
    \}.
\]
This is actually a shorthand for
\[
    \{ \{ \alpha, \beta \}, \{ \alpha, \gamma \}, \dots, \{ \lambda, \mu \}, \{
        \lambda, \nu \}, \dots \}
\]
which we call the canonical form.

A family of equivalences $J$ will induce an equivalence relation which we call $\equiv_J$. We
say $u \pi v \equiv_J u \rho v$ if $\{ \pi, \tau \} \in J$, with $u,v \in \Sym$.

For example, if we say $J = \{ \{ 132, 321 \} \}$ then we consider the patterns $132$ and $321$ to
be equivalent by relation $\equiv_J$. That will, for example, result in
\[
    1\bm{243} \equiv_J 1\bm{432}
\]

An equivalence relation on $\Sym = \cup_{n \geq 1} \Sym_n$ splits each $\Sym_n$
into a set of equivalence classes which we want to enumerate. 

Linton had already made some headway on enumerating equivalence classes the
first two types but the spring of 2021 Claesson published a preprint of his
article that gives a semi-automatic way of enumerating equivalence classes of
the last type.

In this article we will attempt to use Anders method to calculate joint
distributions of as many equivalence classes defined by partitions of $\Sym_3$
as we can.

To enumerate these different equivalence classes this we will introduce
pattern-rewriting systems. They are the only non-automatic part of the method
given by Anders.

\subsection{Pattern-rewriting systems}
A pattern-rewriting system is a subset $R \subset \cup_{n} \Sym_n \times \Sym_n$.
We use the notation $\alpha \patternrule \beta$ for $(\alpha, \beta)$ when referring
to elements of a pattern-rewriting system $R$. 

Juxtaposition of permutations signifies concatenation, so if $\pi=123$ and
$\tau=321$ then $\pi\tau=123654$ with the left argument being unchanged and the
right pushed up.

As for notation, we use the variables $\alpha$ and $\beta$ for whole permutations, 
the variables $\pi$, $\rho$, $\tau$ and $\sigma$ for patterns.
Finally we use the variables $u$ and $v$ for slices of permutations.

We can make this subset induce a \emph{rewrite relation} on $\Sym$ in the following way: We say
$p \to_R q$ for $p, q \in \Sym_k$ if there exists $\alpha \patternrule \beta \in R$ so
we can write $p = u \alpha v$ and $q = u \beta v$, where
$u$ and $v$ are some permutations.  Note that the relation is
length-preserving. For example, if $R = \{123 \patternrule 321\}$, then $1234 \to_R 3214$. 

We denote the domain of $R$ by $\dom(R) = \{\alpha : \alpha \patternrule
\beta \in R\}$. The image of $R$ we in turn write $\img(R) = \{\beta : \alpha
\patternrule \beta \in R\}$. We write the reflexive transitive closure of
$\to_R$ as $\tostar_R$. 

An element $x$ in $\Sym$ is said to be in normal form under the relation $\to_R$
if there is no $y \in \Sym$ so that $x \to_R y$. A relation $\to_R$ is said to be
terminating if there exist no infinite chains $x_0 \to_R x_1 \to_R \cdots$. If
$\to_R$ is terminating then every element has at least one normal form. 

We say a relation is confluent if and only if
$$
    y_1 \fromstar x \tostar y_2 \Longrightarrow 
    \exists z. \  y_1 \tostar z \fromstar y_2.
$$
Intuitively, if $\to_R$ is confluent then that implies that every path we can
take using $\to_R$, from a given permutation, will end up in the same place. 

If a system is both terminating and confluent, then every element has a one and
only one normal form.

\begin{corollary}
    If $R$ is a terminating and confluent pattern-rewriting system, then the set
    of $\dom(R)$-avoiding permutations in $S_n$ is a complete set of
    representatives for $S_n / \equiv_R$, the set of equivalence classes of
    $\equiv_R$.
\end{corollary}

We can derive rewrite relations from a given equivalence relation $\equiv_J$.
We do this by choosing a pattern in each set of equivalent patterns and letting
that be the image pattern. Then for every other pattern in the set we set that
pattern as the domain and the image pattern as the image. Repeat for every set
in the family and catenate the results.

We do it this way to ensure that each rule increases the sum statistic of the
image.

\begin{example}
    The equivalence $\{ \{123, 321 \} \}$ induces an equivalence relation which is
    equal to the equivalence closure of the rewrite relation induced by two
    different single-image systems, namely $\{123 \patternrule 321\}$ or $\{321
    \patternrule 123\}$. The same goes for $\{ \{ 132, 312 \} \}$, $\{132 \patternrule
    312\}$ or $\{312 \patternrule 132\}$.

    The equivalence closure of the rewrite relation induced by each of these
    four rewrite systems: $\{123 \patternrule 321, 132 \patternrule 312\}$, $\{123
    \patternrule 321, 312 \patternrule 132\}$, $\{321 \patternrule 123, 132
    \patternrule 312\}$, $\{321 \patternrule 123, 312 \patternrule 132\}$ is
    equal to the equivalence relation induced by $\{ \{ 123, 321 \} \}$.

    So for all of these $R$ we have that $\equiv_J$ is the same as $\equiv_R$.
\end{example}

An element of an canonical family equivalence relation $\{ \alpha, \beta \}$ is
actually equal to the pair $(\alpha, \beta)$ and $(\beta, \alpha)$.
Deriving an pattern-rewriting system from a family of equivalences is in
practice choosing either element of the pair for each element of the canonical
equivalence relation.

So the problem is reduced to generating a terminating and confluent system $R$
given a family of equivalences. We then enumerate $\dom(R)$-avoiding
permutations which is the same thing as enumerating different equivalence
classes.  Section 2 of Claesson's paper provides us with a way to do that.
\cite{claesson:2021}

\subsection{Increasing statistics}
A \emph{statistic} is any function $f : \Sym \to \mathbb{N}$. We call $f$ an increasing
statistic with respect to $R$ if $\alpha \to_R \beta$ implies that $f(\alpha) < f(\beta)$.

\begin{lemma}
    Let $R$ be a pattern-rewriting system. If there exists an increasing
    statistic with respect to $R$, then $\to_R$ is terminating.    
\end{lemma}

\begin{definition}
    Let the statistic $\sum_\tau(\alpha)$ be the sum of the positions of occurrences of
    the pattern $\tau$ in $\alpha$. We call this statistic the sigma statistic
    parameterized by the pattern $\tau$.
    \cite{claesson:2021}.
\end{definition}


Let's take one example from Claesson's paper.
\begin{example}
    Let's look at the equivalence $\{ \{ 12, 21 \} \}$. We can select the system $\{
        21 \to 12 \}$. This relation induced by the system is terminating since the statistic
    $\sum_{12}$ is increasing on the relation. It's not
    confluent though, since $321 \to 231$ and $321 \to 312$. So we add the rule
    $231 \patternrule 312$ to the system. The relation is still terminating and by Lemma
    3.3 in Claesson's paper we also have a confluent system. We then end up with
    the system 
    \[
        \{ 21 \patternrule 12, 231 \patternrule 312 \}
    \]
    which is the result we are focusing on in this article.

    By his machinery we find that 
    \[
        \sum_{n \geq 1} \Sym_n(21, 231) = \sum_{m \geq 0} m!(x-x^2)^m
    \]
    which is the joint distribution of the equivalence classes defined by 
    $\{ \{ 12, 21 \} \}$, as found by Stanley CITE.
\end{example}

\section{Finding terminating and confluent systems}
Claesson only found systems corresponding to equivalence relations induced by a
single set of equivalent patterns. We will introduce a method for finding
systems for equivalence relations induced by any number of sets.

\subsection{Share invariance}
Let us begin by generalizing the sigma statistic Claesson introduced in his paper.

\begin{definition}
    A sigma statistic parameterized by a set of patterns $\Pi$ is defined as
    $$
        \sum\nolimits_\Pi = \sum_{\pi \in \Pi} \sum\nolimits_{\pi}.
    $$
\end{definition}

We also notice that by definiton of increasing statistic that
$\alpha \to_R \beta$ is equivalent to the statement $u \pi v \to_R u \rho v$
then $f(u \pi v) < f(u \rho v)$.

\begin{lemma}
    Let $R$ be a rewrite system with rules of length $n$. If
    \[
        \pi_j = \rho_j, n-m \leq j \leq n \tag{$\ast\ast$} \  \textnormal{where}
        \ m = \max\nolimits_{\tau \in \img(R)} |\shr(\pi, \tau)|\label{shareinvariance}
    \]
    for each $\pi \patternrule \rho \in R$ then we say each rule is \emph{share
    invariant}, and $\sum_{\img(R)}$ is an increasing statistic with respect to $R$. 
\end{lemma}
\begin{proof}
    Let $\alpha \to_R \beta$. Then there is a rule $\pi \patternrule \rho$ in
    $R$ so that $u \pi v \to_R u \rho v$, where $\alpha = u \pi v$ and $\beta =
    u \rho v$. 

    If elements of $\img(R)$ is fully contained in either $u$ or $v$ then we
    can safely ignore them. If an element (there can only be one) appears in $u\pi$ then
    $u \rho$ will have a higher sigma value. If an element appears in $\pi v$
    then by our condition it will also appear in $\rho v$.
    So
    \[
        \sum\nolimits_{\img(R)}(\alpha) < \sum\nolimits_{\img(R)}(\beta)
    \]
\end{proof}

\begin{corollary}
    Let $R$ be a system that is share invariant. Then $\sum_{\img(R)}$ is an
    increasing statistic for $R$, hence $R$ induces a terminating rewrite relation.
\end{corollary}

We then go through each partition of $\Sym_3$ and look at all the possible
system a partition can generate. We then apply theorem to each of those systems
and weed out those who don't fulfill the theorem's conditions. So for each
partition we are left with a set of systems that are terminating.

\subsection{Making a terminating system confluent}
Lemma $3.3$ in Anders' paper gives us a convinient test to tell if a system is
confluent. 

What we need to show is a system is locally confluent, that is
\begin{lemma}[Lemma 3.3 \cite{claesson:2021}]
    Let $R$ be a terminating pattern rewriting system. Let 
    \begin{equation}
        \Ocal(R) = \cup_{\alpha_1, \alpha_2} \Ocal(\alpha_1, \alpha_2),
    \end{equation}
    where the union is over all pairs $(\alpha_1, \alpha_2) \in \dom(R) \times \dom(R)$. If, for all
    $\pi \in \Ocal(R)$,
    \begin{equation}
        \rho_1 \from \pi \to \rho_2 \Longrightarrow \exists \sigma. \rho_1 \fromstar \sigma \tostar
        \rho_2,
    \end{equation}
    then $\to_R$ is confluent.
        
\end{lemma}

Using this test and a method for adding rules we devise an algorithm. The method we are using is the
naive one, we simply find shortest cluster of the domain of the terminating system that have more than two
normal forms under the system, it diverges, and we add a rule that joins these two normal forms
together.

Below is pseudocode for the algorithm.

\lstset{basicstyle=\footnotesize\ttfamily, frame=single, breaklines=true,
mathescape=true}
\begin{minipage}{\linewidth}
\begin{lstlisting}[title={Algorithm 1}]
confluentize(sys):
    in: a terminating system, sys
        increasing statistic that proves termination of sys, f
    out: a terminating and confluent system or failure

    if sys is confluent then
        return sys

    s := choose shortest diverging cluster in O(R)
    rules := { a -> b | a, b are normal forms of s, f(a -> b) > 0 }

    if rules = $\emptyset$ then
        return failure

    rule := rule from rules chosen by maximum sigma difference of rule

    return algo(sys + rule)
\end{lstlisting}
\end{minipage}

Let us give some proof that these added rules which make the system confluent do
not make the system non-terminating.
 
We have to make sure that the rule adds images or moves them to the right and does not ruin
occurrences of any of the images present in the source permutation.

\[
\begin{tikzcd}  
    & \bm{img}\mathbf{domdom}\bm{img} \arrow[dl] \arrow[dr] & \\
    img\underline{\mathbf{img}\mathrm{dom}}\bm{img} \arrow[bend
    right=30, mapsto]{rr} & & \bm{img}\underline{\mathrm{dom}\mathbf{img}}\bm{img}
\end{tikzcd}
\]

Here img represents a pattern in the image of a system, and dom a pattern in the domain of a system.
If either is bold then that means that it is an actual occurrence of the pattern but if it is not
then the occurrence has been ruined by an application of a rule from the system. The italicized
img's at the beginnig and the end of the pattern represent possible occurrences of img around the
pattern, just to show that they are not ruined either when applying this new rule.

By casual induction we see that even if we take dom from the confluence rules
then they will also be share invariant.

We see that the system is still terminating under the original $\img(R)$ as we see
that a confluence rule is also share invariant under $\img(R)$.

\subsection{Symmetries}
We can use symmetry to help us finding more terminating and confluent systems. 

Say $1423 \sim \{(1,1), (2,4), (3,2), (4,3)\}$. Let us graph it.
% \pattern{ options to tikzpicture }{ |\pi| }{ pi }{ R }
% E.g., for p = ( 3241, { (0,2), (1,3), (1,4), (4,2), (4,3) } ) type:
% \pattern{}{ 4 }{ 1/3, 2/2, 3/4, 4/1 }{ 0/2, 1/3, 1/4, 4/2, 4/3 }
%
\[
\pattern{}{4}{1/1, 2/4, 3/2, 4/3}{}
\]
By turning the picture by $V$ from $D_4$ we get
\[
\pattern{}{4}{1/4, 2/1, 3/3, 4/2}{}
\]
Which is equal to the pattern $4132$.
We can use all the symmetries in $D_4$ to get equivalent families of equivalences or equivalent
systems by using the symmetry on every pattern that is contained in the structure.

\begin{sublemma}
    If $R$ is a pattern-rewriting system and $T$ is a symmetry from $D_4$ then if
    $x \to_R y$ then $T(x) \to_{T[R]} T(y)$.
\end{sublemma}
\begin{proof}
    If $x \to_R y$ then we have $a \patternrule b$ in $R$ so we can write $x = u a v, y = u b v$. We
    have a $T(a) \patternrule T(b)$ in $T[R]$, also $T(a)$ is a pattern in $T(u a v)$ and $T(b)$ is
    a pattern in $T(u b v)$, $T$ must transform $uav$ and $ubv$ in the same way so $T(x) \to_{T[R]}
    T(y)$
\end{proof}

\begin{lemma}
    If $R$ induces a terminating relation then $T[R]$ also does, where $T$ is a symmetry in $D_4$.
\end{lemma}
\begin{proof}
    If $a$ is a normal form under $R$, no $b$ exists so $a \to_R b$, we can set $a = T(a')$ and $b =
    T(b')$ and get $T(a') \to_R T('b)$ and $T('b)$ does not exist, for all $a', b'$.
\end{proof}

\begin{lemma}
    If $R$ is a confluent system then $T[R]$ is also. If lemma 3.3 applies to
    $R$ then it also applies to $T[R]$, where $T$ is a symmetry in $D_4$.
\end{lemma}
\begin{proof}
    If $R$ is locally confluent then $T[R]$ is also since for $R$
    \[
        y_1 \fromstar x \tostar y_2 \Longrightarrow \exists z. \  y_1 \tostar z \fromstar y_2.
    \]
    implies for $T(R)$
    \[ 
        T(y_1) \fromstar T(x) \tostar T(y_2) \Longrightarrow \exists T(z). \
        T(y_1) \tostar T(z) \fromstar T(y_2).
    \]
    and then if $T[R]$ is locally confluent and terminating then by Newmann's
    lemma $T[R]$ is confluent.
\end{proof}

So if $R$ is both terminating and confluent then a symmetry from $D_$ of $R$ is also terminating and
confluent.

It turns out that the equivalence classes induced by $T[R]$ are enumerated by
the same generating function that enumerates the equivalence classes induced by
$R$. We give a proof of that in Appendix A.

\subsection{Examples}
To illustrate the utility of the methods we have introduced we will look at two
examples

\begin{example}
Let $J=\{\{ 132, 312 \}, \{ 213, 231, 321 \}\}$. This family can generate 5
different rewrite systems. We test each one for share invariance and one that
matches is $R=\{ 132 \patternrule 312, 213 \patternrule 321, 231 \patternrule
321 \}$. We then run our confluentzation algorithm on this terminating system
and get the system
...
We know this one is both confluent and terminating so we can go on enumerating
permutations that avoid $\dom(R)$ and get the result.
...
\end{example}

For the next example we also use symmetry.

\begin{example}
Let $J = \{\{123, 132, 231\}, \{312, 321\}\}$. We look for share invariant systems that $J$ might
generate but none come up. We then look at each of the symmetries of $J$ and the rewrite systems
those symmetries generate. When we try $D_2$ we get the family $\{ \{ 123, 132, 312 \}, \{ 231, 321
\} \}$ for which there is a terminating and confluent rewrite system
\[
    \begin{matrix}
        123 \patternrule 312 \\
        132 \patternrule 312 \\
        231 \patternrule 321 \\
        3124 \patternrule 1423 \\
        31254 \patternrule 12534
    \end{matrix}
\]
Then we know $J$ is also terminating and confluent and has the same cluster generating function as
$D_2(J)$, and therefore is in the same Wilf class.

\end{example}

\section{Overview of results}
We can apply the above mentioned results by testing all rewrite systems of a
family of equivelences for share invariance. If it is share invariant.
We can see there are 9 different Wilf classes of those joint distributions we
generated.

\begin{definition}
    We can give a family of equivalences $J$ a size function which is the same
    as the cardinality of the canonical form of the set of equivalences.

    By this definition $| \{ \{ 123, 321 \}, \{ 312, 231, 213 \} \}| = | \{ \{
    123, 321 \}, \{ 312, 231 \}, \{ 312, 213 \} \} | = 3$, for example.
\end{definition}

Let us collate all the results from Appendix A into a table to show how the
different generating functions are distributed.

The joint distribution is always on the form $\sum_{m \geq 0}m!(x+C(x))^m$ where $C$
is the cluster generating function corresponding to the system.

\begin{center}
\begin{tabular}{c|c|c|c}
    $|J|$ & $C_J(x)$ & count & OEIS seq. \\
    \hline
    0 & $0$ & 1 & A000142 \\
    1 & $-x^3$ & 13 & A212580 \\
    2 & $-2x^3$ & 52 & A212432 \\
    2 & $\frac{-x^3-x^4}{x^2+x+1}$ & 2 & A212581 \\
    3 & $-3x^3$ & 62 & \emph{Not present} \\
    3 & $\frac{-2x^3-2x^4-x^5}{x^2+x+1}$ & 10 & A212433 \\
    4 & $-4x^3$ & 8 & \emph{Not present} \\
    4 & $\frac{-3x^3-3x^4-2x^5}{x^2+x+1}$ & 6 & \emph{Not present}\\
    4 & $\frac{-4x^3-2x^4}{x^2+x+1}$ & 1 & \emph{Not present} \\ 
    \hline
    \hline
    5 & $\frac{-5x^3-3x^4-x^5}{x^2+x+1}$ & 1 & \emph{Not present} \\ 
\end{tabular}
\end{center}

If we parameterize each $C_J$ with it's corresponding $J$ value then we have
three different types of cluster generating functions.

Those types are $C'_J(x) = -|J|x^3$, $C''_J(x) = \frac{-|J|x^3-(|J|-1)x^4-(|J|-2)x^5}{x^2+x+1}$
and $C'''_J(x) = \frac{-|J|x^3-(|J|-2)x^4-(|J|-4)x^5}{x^2+x+1}$

For $C'''$ we only generated one system but Anders did generate a system for
$J = \{\{ 123, 132, 213, 231, 312, 321 \}\}$ which cluster generating function
is also $C'''_J$.

So we see that these partitions of $\Sym_3$ are split into three different types
of Wilf-classes, which we can describe by $C'$, $C''$ and $C'''$ and the size
of the partition.

\subsection{Programming}
There were three small programs written for the project: mp for generating the
systems from the equivalence relations, mp for taking the domain of these
systems and calculating the generating functions and finding if their sequences
were found in the OEIS, and finally tester which calculates the first 6 values
of the sequences manually. mp and tester were written in Haskell and mp in Sage Math. 


\section{Problems and questions}

Are there any other Wilf classes that appear for partitions on $\Sym_3$?

The share invariance idea does not apply to every type of rewrite system, but we
have other increasing statistics for them. Take the equivalence $\{ \{ 213, 132
\} \}$ for example. Its rewrite systems ${\{ 213 \patternrule 132 \}}$ and ${\{
132 \patternrule 213 \}}$ don't fulfill \eqref{shareinvariance}. When we
apply some symmetries to it, we get $\{ \{ 312, 231 \} \}$ which has the same
problem.

But for $\{ 213 \patternrule 132 \}$ sigma parameterized by $21$ is an
increasing statistic. Anders used that statistic quite a bit in his paper.

Would similar formulas to the $C_n$ appear again when we would
look at $\Sym_4$? Can we justify why we get these patterns?

Can we describe clearly $C_{1,2,3}$ from how patterns in the base system cluster together?
Why do the exact rules used to make the system confluent not seem to matter?

Can we derive a way to create a cluster generating function directly from a
given family of equivalences? Can we create a test which tells us given a family
of equivalences which of $C_1$, $C_2$ and $C_3$ will enumerate the equivalence
classes induced by those family of equivalences?
Can this way be generalized to partitions of $\Sym_n$, for every $n$?

Does there exist an algorithm that makes all systems confluent?

The limitations of Claesson's method lay mainly in the fact that the domain of a
system must be fully reduced for the calculations to work. For instance, we can not use his
method for $\{ \{ 12, 21 \}, \{ 123, 321, 312, 213 \} \}$.

\begin{conjecture}
    If a partition $J$ on $\Sym_n$ has a system that has no non-self-clusters in
    its domain then its cluster generating function is $x^n-|J|x$.
\end{conjecture}

\begin{openproblem}
    Find a terminating statistic for the rest of the equivalence relations
    defined by partitions of $\Sym_3$.
\end{openproblem}

\section*{Acknowledgments}

\bibliographystyle{plain}
\bibliography{mp}

\clearpage

\begin{appendices}
\section{On enumerating symmetries}
We seperate this proof from the main text since we did not explicitly introduce
generating functions or any of the mechanisms Claesson uses in his paper to
calculate cluster generating functions. Here we assume the reader has read
section 2 of Claesson's paper.

The rewrite systems we generate from $J$ are $\{ a \patternrule b, \dots \}$
and then the rewrite system generated from $T[J]$ are $T[R]=\{ T(a) \patternrule T(b), \dots \}$
so $T[\dom(R)]=\dom(T[R])$

\begin{definition}
    For $\sigma, \tau \in T$ define the set of permutations $\Ocal(\sigma,
    \tau)$ by stipulating that $\pi \in \Ocal(\sigma, \tau)$ if and only if
    \begin{enumerate}
    \item $\sigma$ is a proper prefix of $\pi$,
    \item $\tau$ is a proper suffix of $\pi$ and
    \item $|\pi| < |\sigma| + |\tau|$.
    \end{enumerate}
\end{definition}

\begin{lemma}
Let $\tau$ and $\sigma$ be two patterns and $T$ be an element of $D_4$.
Then 
\[
    \Ocal(T(\tau), T(\sigma)) = T[\Ocal(\tau, \sigma)]
\]
\end{lemma}
\begin{proof}
    $\Ocal(T(\tau), T(\sigma)) \subset T[\Ocal(\tau, \sigma)]$: 
    $x \in \Ocal(T(\tau), T(\sigma))$, then $T(\tau)$ is a proper prefix of
    $x$ and $T(\sigma)$ is a proper suffix of $x$. Since $T$ is a bijection we
    have its inverse, $T^{-1}$. $\tau$ is a proper prefix of $T^{-1}(x)$ and 
    $\sigma$ is a proper suffix of $T^{-1}(x)$. Also $|T^{-1}(x)| = x <
    |T(\tau)| + |T(\sigma)| = |\tau| + |\sigma|$. Then $T^{-1}(x) \in \Ocal(\tau,
    \sigma)$ and so $x \in T[\Ocal(\tau, \sigma)]$.

    $T[\Ocal(\tau, \sigma)] \subset \Ocal(T(\tau), T(\sigma))$: 
    $x \in T[\Ocal(\tau, \sigma)]$. Then $T^{-1}(x) \in \Ocal(\tau, \sigma)$
    $\tau$ is a proper prefix of $T^{-1}(x)$ and $\sigma$ is a proper suffix of $T^{-1}(x)$. 
    $T(\tau)$ is a proper prefix of $x$ and $T(\sigma)$ is a proper suffix of
    $x$. Also $|x| = |T^{-1}(x)| < |\tau| + |\sigma| = |T(\sigma)| + |T(\tau)|$
    And so $x \in \Ocal(T(\tau), T(\sigma))$.
\end{proof}

\begin{corollary}
    We see that since 
    \[
        \Omega(\sigma, \tau) = \sum_{\pi \in \Ocal(\sigma, \tau)} x^{|\pi|-|\sigma|}
    \]
    we have
    \[
        \Omega(T(\sigma), T(\tau)) = \Omega(\sigma, \tau)
    \]
    and therefore $C_{T[J]} = C_J$.
    If we have $J$ and can derive a $C_J$ from it, then for every $T(J)$ we can
    derive a $C_{T(J)}$ and $C_J = C_{T(J)}$.
\end{corollary}

\section{Resulting systems}
We categorize the equivalence families/equivalence relations by what their joint
distribition is.

\newgeometry{left=2cm,right=2cm,top=2cm,bottom=2cm}
\begin{multicols}{2}
\include{appendix}
\end{multicols}
\end{appendices}

\end{document}

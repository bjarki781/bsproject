\documentclass[a4paper, 11pt]{article}
\usepackage[top=3.17cm, bottom=3.27cm, left=3.5cm, right=3.5cm]{geometry}
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{latexsym}
\usepackage{amsmath,amsthm,amssymb,amsfonts}
\usepackage{eucal}
\usepackage[english]{babel}
\usepackage{tikz}
\usepackage{epsfig}
\usepackage{amssymb, graphicx, amsmath, amsthm}
\usepackage{calrsfs}
\usepackage{todonotes}
\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it}
\RequirePackage{graphicx}
\RequirePackage{hyperref}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{openproblem}[theorem]{Open Problem}
\newtheorem*{openproblem*}{Open Problem}
\newtheorem{conjecture}[theorem]{Conjecture}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{remark}[theorem]{Remark}
\newtheorem*{remark*}{Remark}
\newtheorem{example}[theorem]{Example}
\newtheorem*{example*}{Example}

\newcommand{\eps}{\epsilon}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\etal}{et~al.}
\newcommand{\Sym}{\mathpzc{S}}
\newcommand{\Pow}{\mathcal{P}}
\newcommand{\Ocal}{\mathcal{O}}
\newcommand{\emptyword}{\varepsilon}
\newcommand{\id}{\mathrm{id}}
\newcommand{\rid}{\overline{\id}}
\newcommand{\from}{\leftarrow}
\newcommand{\eq}{\leftrightarrow}
\newcommand{\eqstar}{\stackrel{*}{\leftrightarrow}}
\newcommand{\tostar}{\stackrel{*}{\to}}
\newcommand{\toplus}{\stackrel{+}{\to}}
\newcommand{\fromstar}{\stackrel{*}{\from}}
\newcommand{\nf}[1]{{#1\!\downarrow}}
\newcommand{\floor}[1]{\lfloor#1\rfloor}
\newcommand{\bracket}[1]{[\mskip1mu #1\mskip1mu]}
\DeclareMathOperator{\olap}{\mathcal{O}}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\img}{img}
\DeclareMathOperator{\des}{des}
\DeclareMathOperator{\maj}{maj}
\DeclareMathOperator{\len}{len}
\DeclareMathOperator{\shr}{shr}

\begin{document}

\title{Enumerating Hertzsprung Equivalence Classes Defined by Partitions of the Symmetric Group of Degree 3}
\author{Bjarki Hartjenstein Gunnarsson}
\date{\today}
\maketitle

\begin{abstract}
    Hertzsprung patterns are permutation patterns in which both positions and
    values are required to be adjacent. Families of equivalences of these
    patterns induce equivalence classes. In this paper we introduce a method
    that allows us, given an equivalence relation, to enumerate these
    equivalence classes. This in turn allows us to determine the Wilf-classes of
    all the set partitions of $\Sym_3$.
\end{abstract}

\section{Introduction}
Juxtaposition of permutations signifies catenation, so if $\pi=123$ and
$\tau=321$ then $\pi\tau=123654$.

\subsection{Equivalence, equivalence classes and motivation}
An equivalence relation is defined by a family of sets of permutations. We
consider all permutations in each set to be equivalent to each other. An
equivalence relation on $\Sym = \cup_{n \geq 1} \Sym_n$ splits each $\Sym_n$
into a set of equivalence classes.  We want to enumerate those classes.  Work
has been done on classical patterns and ... \cite{linton}  We will focus
exclusively on equivalence relations of Hertzsprung patterns. 

\begin{example}
    If we say $123 \equiv 321, 231 \equiv 312$ then we consider the permutations
    $1234, 3214$ and $1432$ equivalent, they belong together in an equivalence
    class. On the other hand are permutations $1342$ and $1423$ equivalent and belong in
    another class.
\end{example}

To enumerate these different equivalence classes this we will introduce
pattern-rewriting systems.

\subsection{Pattern-rewriting systems}
A pattern-rewriting system is a subset $R \subset \cup_n \Sym_n \times \Sym_n$.
We use the notation $(\alpha \to \beta)$ for $(\alpha, \beta)$ for elements of
$R$.
We can make this subset induce a \emph{rewrite relation} on $\Sym$ in the following way: We say
$p \to_R q$ for $p, q \in \Sym_k$ if there exists $(\alpha \to \beta) \in R$ so
we can write $p = u \alpha v$ and $q = u \beta v$, where
$u$ and $v$ are some permutations.  Note that the relation is
length-preserving.  For example, if $R = {(123 \to 321)}$, then $1234$ relates to
$3214$. The domain of $R$ we denote by $\dom(R) = \{\alpha : (\alpha \to \beta) \in
R\}$. The image of $R$ we in turn denote $\img(R) = \{\beta : (\alpha \to \beta) \in
R\}$. We denote the reflexive transitive closure of $R$ as $\tostar_R$, that is,
any number of applications of $R$. We denote the equivalence closure as
$\equiv_R$. We can skip the subscript if the system that's being discussed is
unamibiguous. 

An element $x$ in $\Sym$ is said to be in normal form under system $R$ if there
is no $y \in \Sym$ so that $x \to_R y$. The relation induced by the system is
said to be terminating if there exist no infinite chains $x_0 \to x_1 \to
\cdots$. If $\to$ is terminating then every element has a normal form. 

A relation is confluent if and only if
$$
    y_1 \fromstar x \tostar y_2 \Longrightarrow 
    \exists z. \  y_1 \tostar z \fromstar y_2.
$$

If a system is both terminating and confluent, then every element has a one and
only one normal form.

\begin{corollary}
    If $R$ is a terminating and confluent pattern-rewriting system, then the set
    of $\dom(R)$-avoiding permutations in $S_n$ is a complete set of
    representives for $S_n / \equiv$, the set of equivalence classes of
    $\equiv$.
\end{corollary}

So the problem is reduced to generating a terminating and confluent system $R$
given a sets of equivalent partitions then enumerating $\dom(R)$-avoiding permutations.
Section 2 of Claesson's paper provides us with a way to do that. \cite{claesson}

We begin with finding systems that terminate, and which we then make confluent.
These terminating systems are composed of single-image systems that each are
created from a respective equivalence relation.

\subsection{Increasing statistics}
A statistic is any function $f : \Sym \to \mathbb{N}$. We call $f$ an increasing
statistic on $R$ if $\pi \to \sigma$ implies that $f(\pi) < f(\sigma)$ for all
$\pi \to \sigma \in R$.

\begin{definition}
    Let the statistic $\sum_\tau$ be the sum of the positions of occurences of
    the pattern $\tau$. 
    \cite{claesson}.
\end{definition}

\begin{lemma}
    Let $R$ be a pattern-rewriting system. If there exists an increasing
    statistic with respect to $R$, then $\to$ is terminating.    
\end{lemma}

Let's take one example from Claesson's paper.
\begin{example}
    Let's look at the equivalence $12 \equiv 21$. We can choose the system 
    $\{ 21 \to 12 \}$. This is terminating since the statistic $\sum_{12}$ is
    increasing for that system. It's not confluent though, since $321 \to 231$
    and $321 \to 312$. So we add the rule $231 \to 312$ to the system and we
    have a confluent system by Lemma 3.3 in Claesson's paper. 

    By his machinery we find that $\sum_{n \geq 1} \Sym_n(21) = \sum_{m \geq 0}
    m!(x-x^2)^m$ which is the joint distribution of the equivalence classes
    defined by $12 \equiv 21$.
\end{example}

\section{Finding terminating systems systematically}
Claesson only found systems corresponding to equivalence relations induced by a
single set of equivalent patterns. We will introduce a method for finding
systems for equivalence relations induced by any number of sets.

Let's begin focussing on \emph{single-image systems}. That is, systems, which
have only a single pattern as their image. Claesson looked at these kinds
of systems. A single-image system corresponds to a set of patterns.
We then catenate a family the single-image systems to
create a system that correponds to a respective family of equivalences.

\begin{example}
    The equivalence $123 \equiv 321$ allows two single-image systems, namely
    $\{(123 \to 321)\}$ or $\{(321 \to 123)\}$. The same goes for $132 \equiv 312$,
    $\{(132 \to 312)\}$ or $\{(312 \to 132)\}$.

    Then the equivalence family $\{123 \equiv 321, 132 \equiv 312\}$ can then generate
    four possible systems: $\{(123 \to 321), (132 \to 312)\}$, $\{(123 \to 321),
    (312 \to 132)\}$, etc.
\end{example}

Let us introduce a method for determining a terminating system given an
equivalence of patterns.

\begin{lemma}
    Let $E$ be a single-image system. If $\pi \to \rho$ is in $E$ and 
    \[
        \sum\nolimits_\rho(u\pi v) < \sum\nolimits_\rho(u \rho v) \tag{$\ast$}
        \label{increasingimage}
    \]
    then $\sum$ parameterized by the image of $E$ is an increasing statistic on
    $E$.
\end{lemma}
\begin{proof}
    If $\pi \to \rho$ is in $E$ then we see $\sum_\rho(\pi) <
    \sum_\rho(\rho)$.  We see that each application of a rule of the system
    will only make the resulting permutation have a higher sigma value.
\end{proof}

Let us introduce some notation. Let $\pi$ be a permutation, we can then take a
slice of that permutation by $\pi[i:j]$ which means we take digits of $\pi$ from
position $i$ up to (not including) position $j$. A negative index signifies that
we index from the right hand side, instead of the left hand side. We also let $\shr(\alpha,
\beta)$ signify the part where, if $\alpha$ and $\beta$ form a cluster, they
share. $\shr(132, 213) = 32$. We assume that they just have one cluster, since
we're not clustering the same pattern, 123 and 123, for example. $\len$ is just
the length of a subpermutation.

\begin{lemma}
    Let $E$ be a single-image system with $\{\rho\} = \img(E)$. If
    \[
        \pi_i[-l_i:0] = \rho[-l_i:0] \quad \textnormal{where} \quad l_i :=
        \len(\shr(\pi_i, \rho)) \tag{$\ast\ast$} \label{joininvariance}
    \]
    for each $\pi_i \to \rho \in E$ then $E$ fulfills condition
    \eqref{increasingimage}. \end{lemma}
\begin{proof}
    Let us assume that we have a rule in $E$, namely $\pi \to \rho$ and so
    $0 = \sum_\rho(\pi) < \sum_\rho(\rho) = 1$. Then $u \pi v \to u \rho v$. 
    If $\rho$ is fully contained in either $u$ or $v$ then $\to$ won't have any
    implication for those occurences. If $\rho$ appears in $u\pi$ then
    application of the rule will move it further to the right, increasing the
    value of sigma. If $\rho$ appears in $\pi v$ then we assume it's static for
    that part so we will have two occurences of $\rho$, one where $\pi$ was and
    then we did not alter other one.
    We can see that every application of rules from $R$ will increase.
\end{proof}

So by looking at the two lemmas together we have that if a single-image system
fulfills \eqref{joininvariance} then sigma parameterized by the image of $E$ is
an increasing statistic. Hence $E$ is terminating.

Let us turn to families of equivalences which can generate systems with more
than one image.

\begin{lemma}
    A number of single image systems catenated together induce an equivalence
    relation that is the same as define by a family of equivalences
    corresponding to each system.
\end{lemma}

\begin{definition}
    A sigma statistic parameterized by a set of patterns is defined as
    $$
        \sum\nolimits_{\{\tau_0, ..., \tau_n\}}(x) = \sum_{i=0}^{n} \sum\nolimits_{\tau_i}(x).
    $$
    We see this is an increasing statistic for a concatenation of systems if
    each system has an increasing $\sum_{\tau_i}$.  Each rule application will
    increase one statistic, and then the whole sum of the statistics.
\end{definition}

With this new definiton we can work with equivalence relations that contain more than one
equivalence.

\begin{theorem}
    Let $R$ be a system composed of the single-image systems $E_i$ which fulfill
    condition \eqref{joininvariance}. We say $\{\rho_i\} = \img(E_i)$. Then $\sum\nolimits_{\rho_i}$ 
    is an increasing statistic for each $E_i$ and then by summing these
    statistics together we have an increasing statistic for $R$.
    The system $R$ is hence terminating.
\end{theorem}

This theorem works well but it does not work for every possible equivalence relation.
Take the equivalence $213 \equiv 132$ for example, none of its single-image systems fulfill
\eqref{joininvariance} and when we apply some symmetries to it, we get $312
\equiv 231$ which has the same problem.

But for $213 \equiv 132$ sigma parameterized by a smaller statistic, namely $21$, is an
increasing statistic so $\{ 213 \to 132 \}$ is a terminating system.

With these observation we are able to find terminating systems for all set
partitions on $\Sym_3$.

\todo{this definition is just me spitballing}
\begin{definition}
    So an appearence of one image will increase the statistic more then the
    appearence of another type of image.

    Each application of the system will increase the statistic somewhat.

    If some image can cluster after permutations in domains then we let that
    image have more priority than the other images. (is there a system where two
    images cluster before each other???

    Does it solve the problem of 231=312?
\end{definition}

\section{Making a terminating system confluent}
First we can reduce the amount we check by the symmetries of the square.
If we show that a system is both terminating and confluent, then all systems
which we can arrive at through mirroring the permutations etc are also
terminating and confluent.

I have not found one algorithm that can make all systems confluent.
I'm using two.

With a system that is terminating, then it's possible to preserve its
termination when making it confluent.
By ensuring that all rules that are added have a positive sigma difference
we can be certain that a system is still confluent. 


\section{Application, result and verification}
There are 10 different Wilf-classes for the equivalences of partitions of $S_3$.

The joint distribution is always on the form $\sum_{m \geq 0}m!C(x)^m$ where $C$
is the cluster generating function corresponding to the system.

A formula appears for the cluster generating function, $C_n(x) = x-nx^3$, $n$ being the number of rules
in the terminating system generated from the equivalence family.
\begin{center}
\begin{tabular}{c|c|c|c}
    $n$ & $C(x)$ & count & OEIS seq. \\
    \hline
    0 & $x$ & 1 & A000142 \\
    1 & $x-x^3$ & 15 & A212580 \\
    2 & $x-2x^3$ & 63 & A212432 \\
    3 & $x-3x^3$ & 78 & Not present \\
    4 & $x-4x^3$ & 18 & Not present \\
\end{tabular}
\end{center}
This formula constitutes 175 of the 203 equivalence relations.

\begin{center}
\begin{tabular}{c|c|c|c}
    $n$ & $C(x)$ & count & OEIS seq. \\
    \hline
    2 & $\frac{x+x^2-x^3-x^4}{x^2+x+1}$ & 2 & A212581 \\
    3 & $\frac{x+x^2-2x^3-2x^4-x^5}{x^2+x+1}$ & 12 & A212433 \\
    4 & $\frac{x+x^2-3x^3-3x^4-2x^5}{x^2+x+1}$ & 12 & Not present\\
\end{tabular}
\end{center}
We see if the parameterize $C(x)$ by $n$ we get the following equation.
\[
    C_n(x) = \frac{x+x^2-(n-1)x^3-(n-1)x^4-(n-2)x^5}{x^2+x+1}
\]

\begin{center}
\begin{tabular}{c|c|c|c}
    $n$ & $C(x)$ & count & OEIS seq. \\
    \hline
    4 & $\frac{x+x^2-3x^3-2x^4}{x^2+x+1}$ & 1 & Not present \\ 
    5 & $\frac{x+x^2-4x^3-3x^4-x^5}{x^2+x+1}$ & 1 & Not present\\
\end{tabular}
\end{center}
We see if the parameterize $C(x)$ by $n$ we get the following equation.
\[
    C_n(x) = \frac{x+x^2-(n-1)x^3-(n-2)x^4-(n-4)x^5}{x^2+x+1}
\]
\[
    = (x+x^2-(n-1)x^3-(n-2)x^4-(n-4)x^5)\sum_{m \geq 0}(-x^2-x)^m.
\]


\subsection{Programming}
There were three small programs written for the project: mp for generating the
systems from the equivalence relations, mp2 for taking the domain of these
systems and calculating the generating functions and finding if their sequences
were found in the OEIS, and finally tester which calculates the first 6 values
of the sequences manually. mp and tester were written in Haskell and mp2 in SageMath. 


\section{Problems, questions, remarks}
Are there larger systems, for example from $\Sym_4$, where we cannot apply the
methods used in this paper?

Would similar formulas to the $C_n$ appear again when we would
look at $\Sym_4$? Can we justify why we get these patterns?

Can we describe clearly $C_n$ from how patterns in the base system cluster together?
Why do the rules used to make the system confluent not seem to matter?

(look at linton)

\bibliographystyle{plain}
\bibliography{mp}

\end{document}
